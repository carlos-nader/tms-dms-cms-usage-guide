<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIP & Version Name Generator</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-green-500: rgba(34, 197, 94, 1);

            --bg: var(--color-cream-50);
            --surface: var(--color-cream-100);
            --text: var(--color-slate-900);
            --text-secondary: var(--color-slate-500);
            --primary: var(--color-teal-500);
            --primary-hover: var(--color-teal-600);
            --primary-active: var(--color-teal-700);
            --border: rgba(94, 82, 64, 0.2);
            --accent: var(--color-teal-300);
            --success: var(--color-green-500);
            --error: var(--color-red-500);
            --warning: var(--color-orange-500);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        body {
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            margin: 0 0 8px 0;
            font-size: 32px;
            font-weight: 600;
            color: var(--text);
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--surface);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .card h2 {
            margin: 0 0 20px 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text);
        }

        .label-with-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .rule-link {
            font-size: 12px;
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 200ms;
        }

        .rule-link:hover {
            background: rgba(33, 128, 141, 0.1);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            color: var(--text);
            background: var(--white);
            transition: border-color 200ms;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-primary:active {
            background: var(--primary-active);
        }

        .output-section {
            background: var(--white);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .output-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .output-filename {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: var(--text);
            word-break: break-all;
            font-weight: 500;
            padding: 12px;
            background: var(--gray-200);
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .validation-result {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .validation-icon {
            font-size: 16px;
            font-weight: bold;
        }

        .success {
            color: var(--success);
        }

        .error {
            color: var(--error);
        }

        .warning {
            color: var(--warning);
        }

        .rules-section {
            margin-top: 40px;
            border-top: 2px solid var(--border);
            padding-top: 30px;
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .tab-button {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 200ms;
            margin-bottom: -1px;
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-button:hover {
            color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .rule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .rule-table th {
            background: rgba(33, 128, 141, 0.08);
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            color: var(--text);
        }

        .rule-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
        }

        .rule-table tr:hover {
            background: rgba(33, 128, 141, 0.04);
        }

        .example-code {
            background: var(--gray-200);
            border-left: 3px solid var(--primary);
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 12px 0;
            overflow-x: auto;
        }

        .rule-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .rule-section:last-child {
            border-bottom: none;
        }

        .rule-section h3 {
            margin: 0 0 8px 0;
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        .rule-section p {
            margin: 0 0 8px 0;
            font-size: 13px;
            line-height: 1.6;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(33, 128, 141, 0.15);
            color: var(--primary);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            font-family: 'Courier New', monospace;
            margin-right: 6px;
        }

        .info-box {
            background: rgba(33, 128, 141, 0.08);
            border-left: 4px solid var(--primary);
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 16px;
        }

        .copy-button {
            padding: 8px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 200ms;
        }

        .copy-button:hover {
            background: var(--primary-hover);
        }

        .help-icon {
            cursor: help;
            color: var(--primary);
            font-weight: bold;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--charcoal-800);
            color: white;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 200ms;
            font-size: 12px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }

            .input-group {
                grid-template-columns: 1fr;
            }
        }

        .wip-mode, .guide-mode {
            display: none;
        }

        .wip-mode.active, .guide-mode.active {
            display: block;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: var(--white);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 200ms;
            color: var(--text);
        }

        .mode-btn.active {
            border-color: var(--primary);
            background: rgba(33, 128, 141, 0.08);
            color: var(--primary);
        }

        .mode-btn:hover {
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WIP & Version Name Generator</h1>
            <p class="subtitle">Falcon BMS TMS/DMS/CMS Guide — File & Version Naming Tool</p>
        </header>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('wip')">WIP File Naming (v1.3)</button>
            <button class="mode-btn" onclick="setMode('guide')">Guide Version (v4.1)</button>
        </div>

        <!-- WIP MODE -->
        <div class="wip-mode active">
            <div class="main-layout">
                <!-- WIP Generator -->
                <div class="card">
                    <h2>WIP File Name Generator</h2>
                    
                    <div class="form-group">
                        <div class="label-with-link">
                            <label>File Category</label>
                            <a class="rule-link" onclick="scrollToTab('wip-rules', 'categories')">View Rules →</a>
                        </div>
                        <select id="wipCategory" onchange="updateWIPFields()">
                            <option value="">-- Select Category --</option>
                            <option value="chapter">Chapter</option>
                            <option value="section">Section / Subsection</option>
                            <option value="table">Table</option>
                            <option value="notes">Notes</option>
                            <option value="visual">Visual / Diagram</option>
                        </select>
                    </div>

                    <!-- Chapter Fields -->
                    <div id="chapterFields" style="display:none;">
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Chapter Number (1-7)</label>
                                <a class="rule-link" onclick="showInfo('chapterNum')">?</a>
                            </div>
                            <input type="number" id="chapterNum" min="1" max="7" placeholder="e.g., 3">
                        </div>
                        <div class="form-group">
                            <label>Title (slugified)</label>
                            <input type="text" id="chapterTitle" placeholder="e.g., tms-overview">
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Status</label>
                                <a class="rule-link" onclick="scrollToTab('wip-rules', 'status')">Status Codes →</a>
                            </div>
                            <select id="chapterStatus">
                                <option value="">-- Select Status --</option>
                                <option value="dev">dev (draft, no review)</option>
                                <option value="review">review (under human review)</option>
                                <option value="approved">approved (integrated & archived)</option>
                                <option value="deprecated">deprecated (abandoned or rejected)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section Fields -->
                    <div id="sectionFields" style="display:none;">
                        <div class="input-group">
                            <div class="form-group">
                                <label>Chapter (1-7)</label>
                                <input type="number" id="secChapter" min="1" max="7" placeholder="3">
                            </div>
                            <div class="form-group">
                                <label>Section Number</label>
                                <input type="number" id="secSection" min="1" placeholder="1">
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>Subsection (optional)</label>
                                <input type="number" id="secSubsection" min="1" placeholder="Leave blank if none">
                            </div>
                            <div class="form-group">
                                <label>Sub-subsection (optional)</label>
                                <input type="number" id="secSubsubsection" min="1" placeholder="Avoid if possible">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Title (slugified)</label>
                            <input type="text" id="secTitle" placeholder="e.g., fcr-crm-modes">
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Status</label>
                                <a class="rule-link" onclick="scrollToTab('wip-rules', 'status')">Status Codes →</a>
                            </div>
                            <select id="secStatus">
                                <option value="">-- Select Status --</option>
                                <option value="dev">dev (draft)</option>
                                <option value="review">review (under iteration)</option>
                                <option value="final">final (approved, ready to integrate)</option>
                                <option value="approved">approved (integrated & archived)</option>
                                <option value="deprecated">deprecated (discarded)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Table Fields -->
                    <div id="tableFields" style="display:none;">
                        <div class="input-group">
                            <div class="form-group">
                                <label>Chapter (1-7)</label>
                                <input type="number" id="tblChapter" min="1" max="7" placeholder="3">
                            </div>
                            <div class="form-group">
                                <label>Context Code</label>
                                <input type="text" id="tblContext" placeholder="AA, AG, DGFT, NAV, MFDS, etc.">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Switch Type</label>
                                <a class="rule-link" onclick="showInfo('tblSwitch')">?</a>
                            </div>
                            <select id="tblSwitch">
                                <option value="">-- Select --</option>
                                <option value="TMS">TMS (Tactical Mode Switch)</option>
                                <option value="DMS">DMS (Defensive Management System)</option>
                                <option value="CMS">CMS (Countermeasure System)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Status</label>
                                <a class="rule-link" onclick="scrollToTab('wip-rules', 'table-status')">Table Status →</a>
                            </div>
                            <select id="tblStatus">
                                <option value="">-- Select Status --</option>
                                <option value="dev">dev (0-70% filled)</option>
                                <option value="review">review (70-99% filled)</option>
                                <option value="final">final (99-100% complete)</option>
                                <option value="approved">approved (integrated & archived)</option>
                                <option value="deprecated">deprecated (discarded)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Notes Fields -->
                    <div id="notesFields" style="display:none;">
                        <div class="form-group">
                            <label>Chapter or 'GEN'</label>
                            <input type="text" id="notesChapter" placeholder="C3, C4, or GEN">
                        </div>
                        <div class="form-group">
                            <label>Topic</label>
                            <input type="text" id="notesTopic" placeholder="e.g., fcr-radar-modes">
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Note Type</label>
                                <a class="rule-link" onclick="scrollToTab('wip-rules', 'note-types')">Note Types →</a>
                            </div>
                            <select id="notesType">
                                <option value="">-- Select Type --</option>
                                <option value="research">research (raw research, citations)</option>
                                <option value="snippet">snippet (draft explanations)</option>
                                <option value="outline">outline (structure planning)</option>
                                <option value="questions">questions (gaps, clarifications)</option>
                                <option value="reference">reference (citations, bibliography)</option>
                                <option value="example">example (practical examples)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Visual Fields -->
                    <div id="visualFields" style="display:none;">
                        <div class="input-group">
                            <div class="form-group">
                                <label>Chapter (1-7)</label>
                                <input type="number" id="visChapter" min="1" max="7" placeholder="7">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="visDescription" placeholder="tms-hat-layout">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>Visual Type</label>
                                <a class="rule-link" onclick="scrollToTab('wip-rules', 'visual-types')">Types →</a>
                            </div>
                            <select id="visType">
                                <option value="">-- Select Type --</option>
                                <option value="diagram">diagram (layout, architecture)</option>
                                <option value="flowchart">flowchart (decision trees, flow)</option>
                                <option value="schematic">schematic (system block diagrams)</option>
                                <option value="reference">reference (quick-ref cards)</option>
                                <option value="illustration">illustration (annotated screenshots)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="visStatus">
                                <option value="">-- Select --</option>
                                <option value="dev">dev (draft)</option>
                                <option value="review">review (under refinement)</option>
                                <option value="final">final (approved)</option>
                                <option value="approved">approved (integrated & archived)</option>
                                <option value="deprecated">deprecated (discarded)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>File Extension</label>
                            <input type="text" id="visExtension" placeholder="svg, pdf, png, or tex">
                        </div>
                    </div>

                    <!-- Common Date Field -->
                    <div class="form-group">
                        <div class="label-with-link">
                            <label>Date (YYYY-MM-DD)</label>
                            <a class="rule-link" onclick="showInfo('dateWIP')">Date Format →</a>
                        </div>
                        <input type="text" id="wipDate" placeholder="2026-01-15">
                    </div>

                    <button class="btn btn-primary" onclick="generateWIPName()">Generate WIP Name</button>

                    <div class="output-section" id="wipOutput" style="display:none;">
                        <div class="output-label">Generated Filename</div>
                        <div class="output-filename" id="wipFilename"></div>
                        <div id="wipValidation"></div>
                        <button class="copy-button" onclick="copyToClipboard('wipFilename')">Copy to Clipboard</button>
                    </div>
                </div>

                <!-- WIP Quick Reference -->
                <div class="card">
                    <h2>Quick Reference</h2>
                    <div class="info-box">
                        <strong>Key Principle:</strong> WIP files do not change the guide version. Only integration into <code>guide-v*.tex</code> triggers version bumps.
                    </div>

                    <div class="rule-section">
                        <h3>Date Format (WIP only)</h3>
                        <p><strong>Always use: YYYY-MM-DD</strong></p>
                        <div class="example-code">✅ 2026-01-15
✅ 2026-02-05
❌ 20260115 (use for guide version, not WIP)
❌ 01/15/2026 (ambiguous locale)</div>
                    </div>

                    <div class="rule-section">
                        <h3>File Organization</h3>
                        <p><strong>Active WIP:</strong> stored in <code>WIP/</code> folder</p>
                        <p><strong>Completed/Deprecated:</strong> moved to <code>ARCHIVE/</code> with updated status</p>
                    </div>

                    <div class="rule-section">
                        <h3>Status Lifecycle</h3>
                        <p><strong>Normal path:</strong> dev → review → final → approved</p>
                        <p><strong>Discard paths:</strong> dev/review/final → deprecated</p>
                        <p><strong>Forbidden:</strong> No backwards transitions (review ↛ dev, final ↛ review)</p>
                    </div>

                    <div class="rule-section">
                        <h3>AI vs Human Decisions</h3>
                        <p><strong>AI:</strong> Can rename dev → review when explicitly asked ("improve", "fix", etc.)</p>
                        <p><strong>Human:</strong> Decides final, approved, deprecated status. Moves files to ARCHIVE/.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- GUIDE VERSION MODE -->
        <div class="guide-mode">
            <div class="main-layout">
                <!-- Guide Version Generator -->
                <div class="card">
                    <h2>Guide Version Name Generator</h2>

                    <div class="info-box">
                        <strong>Current Regime:</strong> Pre-publication (0.x.x.x) — Active guide v0.2.2.0
                    </div>

                    <div class="form-group">
                        <div class="label-with-link">
                            <label>Regime</label>
                            <a class="rule-link" onclick="scrollToTab('guide-rules', 'regime')">Regime Overview →</a>
                        </div>
                        <select id="guideRegime" onchange="updateGuideFields()">
                            <option value="">-- Select Regime --</option>
                            <option value="prepub">Pre-publication (0.x.x.x)</option>
                            <option value="postpub">Post-publication (x.x.x)</option>
                        </select>
                    </div>

                    <!-- Pre-pub Fields -->
                    <div id="prepubFields" style="display:none;">
                        <div class="info-box">
                            <strong>0.x.x.x Format:</strong> MAJOR=0, MINOR=chapter index, PATCH=structure, SUBPATCH=typos/refinements
                        </div>
                        <div class="form-group">
                            <div class="label-with-link">
                                <label>MINOR (Chapter Index)</label>
                                <a class="rule-link" onclick="showInfo('minor')">What is MINOR? →</a>
                            </div>
                            <input type="number" id="prepubMinor" min="1" max="7" placeholder="1-7">
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>PATCH</label>
                                <input type="number" id="prepubPatch" min="0" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label>SUBPATCH</label>
                                <input type="number" id="prepubSubpatch" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Post-pub Fields -->
                    <div id="postpubFields" style="display:none;">
                        <div class="info-box">
                            <strong>x.x.x Format:</strong> MAJOR=edition, MINOR=substantial revision, PATCH=corrections
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>MAJOR (Edition)</label>
                                <input type="number" id="postpubMajor" min="1" placeholder="1">
                            </div>
                            <div class="form-group">
                                <label>MINOR</label>
                                <input type="number" id="postpubMinor" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>PATCH</label>
                            <input type="number" id="postpubPatch" min="0" placeholder="0">
                        </div>
                    </div>

                    <!-- Common Date Field -->
                    <div class="form-group">
                        <div class="label-with-link">
                            <label>Build Date (YYYYMMDD - compact format)</label>
                            <a class="rule-link" onclick="showInfo('dateGuide')">Date Format →</a>
                        </div>
                        <input type="text" id="guideDate" placeholder="20260108">
                    </div>

                    <button class="btn btn-primary" onclick="generateGuideName()">Generate Guide Version</button>

                    <div class="output-section" id="guideOutput" style="display:none;">
                        <div class="output-label">Generated Filename</div>
                        <div class="output-filename" id="guideFilename"></div>
                        <div id="guideValidation"></div>
                        <button class="copy-button" onclick="copyToClipboard('guideFilename')">Copy to Clipboard</button>
                    </div>

                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <h3 style="margin: 0 0 12px 0; font-size: 14px;">LaTeX Macros</h3>
                        <p style="font-size: 12px; margin: 0 0 8px 0; color: var(--text-secondary);">Update these in your guide preamble:</p>
                        <div id="latexMacros" class="example-code" style="display:none;"></div>
                    </div>
                </div>

                <!-- Guide Version Reference -->
                <div class="card">
                    <h2>Quick Reference</h2>

                    <div class="info-box">
                        <strong>Golden Rule:</strong> Only integration into <code>guide-v*.tex</code> changes the version. WIP file status changes do not.
                    </div>

                    <div class="rule-section">
                        <h3>Date Format (Guide only)</h3>
                        <p><strong>Always use: YYYYMMDD (no hyphens)</strong></p>
                        <div class="example-code">✅ guide-v0.2.2.0-20260108.tex
❌ guide-v0.2.2.0-2026-01-08.tex (use hyphens for WIP, not guide)
❌ guide-v0.2.2.0-20260108.tex (missing date)</div>
                    </div>

                    <div class="rule-section">
                        <h3>Pre-pub (0.x.x.x) Summary</h3>
                        <p><strong>MINOR ⬆️</strong> New chapter enters guide</p>
                        <p><strong>PATCH ⬆️</strong> Structure change (sections, tables reorganized)</p>
                        <p><strong>SUBPATCH ⬆️</strong> Typos, wording, small adjustments</p>
                    </div>

                    <div class="rule-section">
                        <h3>Post-pub (x.x.x) Summary</h3>
                        <p><strong>MAJOR ⬆️</strong> New edition (structure reorganized broadly)</p>
                        <p><strong>MINOR ⬆️</strong> Substantial revision (new chapters, big expansions)</p>
                        <p><strong>PATCH ⬆️</strong> Corrections and local fixes</p>
                    </div>

                    <div class="rule-section">
                        <h3>Critical: Three Values Must Match</h3>
                        <p>✅ LaTeX <code>\docversion</code></p>
                        <p>✅ Filename version number</p>
                        <p>✅ PROJECT-TRACKING entry</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- RULES SECTION -->
        <div class="rules-section">
            <h2>Complete Rules Reference</h2>

            <div class="tabs">
                <button class="tab-button active" onclick="switchTab(event, 'wip-rules')">WIP v1.3</button>
                <button class="tab-button" onclick="switchTab(event, 'guide-rules')">Version System v4.1</button>
            </div>

            <!-- WIP Rules Tab -->
            <div id="wip-rules" class="tab-content active">
                <div id="categories" class="rule-section">
                    <h3>1. File Categories & Patterns</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Pattern</th>
                                <th>Example</th>
                                <th>Status Codes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Chapters</strong></td>
                                <td><code>chapter-C{N}-{TITLE}-{STATUS}-{DATE}.tex</code></td>
                                <td><code>chapter-C2-hotas-fundamentals-dev-2026-01-20.tex</code></td>
                                <td>dev, review, approved, deprecated</td>
                            </tr>
                            <tr>
                                <td><strong>Sections</strong></td>
                                <td><code>section-C{N}-S{M}[-S{K}]-{TITLE}-{STATUS}-{DATE}.tex</code></td>
                                <td><code>section-C5-S2-cms-actuation-review-2026-01-08.tex</code></td>
                                <td>dev, review, final, approved, deprecated</td>
                            </tr>
                            <tr>
                                <td><strong>Tables</strong></td>
                                <td><code>table-C{N}-{CONTEXT}-{SWITCH}-{STATUS}-{DATE}.tex</code></td>
                                <td><code>table-C3-AA-TMS-review-2026-01-17.tex</code></td>
                                <td>dev, review, final, approved, deprecated</td>
                            </tr>
                            <tr>
                                <td><strong>Notes</strong></td>
                                <td><code>notes-C{N}|GEN-{TOPIC}-{TYPE}-{DATE}.md</code></td>
                                <td><code>notes-C3-fcr-modes-research-2026-01-12.md</code></td>
                                <td>(no formal status)</td>
                            </tr>
                            <tr>
                                <td><strong>Visuals</strong></td>
                                <td><code>visual-C{N}-{DESC}-{TYPE}-{STATUS}-{DATE}.{ext}</code></td>
                                <td><code>visual-C7-tms-layout-diagram-dev-2026-01-18.svg</code></td>
                                <td>dev, review, final, approved, deprecated</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="status" class="rule-section">
                    <h3>2. Status Codes & Meanings</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Category</th>
                                <th>Meaning</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="status-badge">dev</span></td>
                                <td>All types</td>
                                <td>Draft, never reviewed by human</td>
                                <td>WIP/</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">review</span></td>
                                <td>Section, Table, Visual, Chapter</td>
                                <td>Under human review, in iteration cycle</td>
                                <td>WIP/</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">final</span></td>
                                <td>Section, Table, Visual</td>
                                <td>Human-approved, ready to integrate</td>
                                <td>WIP/</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">approved</span></td>
                                <td>All types</td>
                                <td>Integrated into guide & archived</td>
                                <td>ARCHIVE/</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">deprecated</span></td>
                                <td>All types</td>
                                <td>Abandoned or rejected</td>
                                <td>ARCHIVE/</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="table-status" class="rule-section">
                    <h3>3. Table Status & Fill Levels</h3>
                    <p>Tables use status codes tied to completion percentage:</p>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Fill Level</th>
                                <th>Meaning</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="status-badge">dev</span></td>
                                <td>0-70%</td>
                                <td>Structure defined, rows being populated, never reviewed</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">review</span></td>
                                <td>70-99%</td>
                                <td>Human reviewed, rows being refined in iteration</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">final</span></td>
                                <td>99-100%</td>
                                <td>Complete, human approval given, ready to integrate</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge">approved</span></td>
                                <td>100%</td>
                                <td>Integrated into guide, archived as historical</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="note-types" class="rule-section">
                    <h3>4. Note Types (for notes-* files)</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Purpose</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>research</code></td>
                                <td>Raw research, citations, external references</td>
                                <td><code>notes-C3-fcr-research-2026-01-12.md</code></td>
                            </tr>
                            <tr>
                                <td><code>snippet</code></td>
                                <td>Partial paragraphs, early-stage writing</td>
                                <td><code>notes-C4-dms-snippet-2026-01-14.md</code></td>
                            </tr>
                            <tr>
                                <td><code>outline</code></td>
                                <td>Detailed outline, structure planning</td>
                                <td><code>notes-C5-cms-outline-2026-01-15.md</code></td>
                            </tr>
                            <tr>
                                <td><code>questions</code></td>
                                <td>Open questions, gaps to fill</td>
                                <td><code>notes-GEN-missing-content-questions-2026-01-16.md</code></td>
                            </tr>
                            <tr>
                                <td><code>reference</code></td>
                                <td>Citation compilations, bibliography</td>
                                <td><code>notes-C3-dash34-reference-2026-01-13.md</code></td>
                            </tr>
                            <tr>
                                <td><code>example</code></td>
                                <td>Practical examples, test cases, scenarios</td>
                                <td><code>notes-C3-tms-example-2026-01-17.md</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="visual-types" class="rule-section">
                    <h3>5. Visual Types & Formats</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Purpose</th>
                                <th>Typical Format</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>diagram</code></td>
                                <td>HOTAS layout, system architecture, block diagrams</td>
                                <td>.svg, .pdf</td>
                                <td><code>visual-C7-tms-layout-diagram-dev-2026-01-28.svg</code></td>
                            </tr>
                            <tr>
                                <td><code>flowchart</code></td>
                                <td>Decision trees, mode progression, operational flow</td>
                                <td>.tex (TikZ), .svg, .pdf</td>
                                <td><code>visual-C3-mode-flowchart-review-2026-01-20.tex</code></td>
                            </tr>
                            <tr>
                                <td><code>schematic</code></td>
                                <td>System block diagrams, functional architecture</td>
                                <td>.svg, .pdf</td>
                                <td><code>visual-C4-mfds-schematic-review-2026-01-19.svg</code></td>
                            </tr>
                            <tr>
                                <td><code>reference</code></td>
                                <td>Quick-ref cards, checklists, summary sheets</td>
                                <td>.pdf, .png</td>
                                <td><code>visual-C6-tms-quick-reference-final-2026-01-25.pdf</code></td>
                            </tr>
                            <tr>
                                <td><code>illustration</code></td>
                                <td>Annotated screenshots, labeled images</td>
                                <td>.png, .pdf</td>
                                <td><code>visual-C3-tms-example-illustration-final-2026-01-22.png</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-section">
                    <h3>6. Key Rules</h3>
                    <p><strong>Character Set:</strong> Lowercase, hyphens only, no underscores in body, no spaces, dots reserved for extension</p>
                    <p><strong>Date Format (WIP):</strong> <code>YYYY-MM-DD</code> (with hyphens)</p>
                    <p><strong>Max Filename:</strong> 100 characters recommended; 255 absolute limit</p>
                    <p><strong>Title Slugification:</strong> 2-4 key concepts, abbreviate if long, prefer acronyms (FCR, CRM, TMS, DMS, CMS, SAM)</p>
                    <p><strong>Hierarchy:</strong> Prefer shallow (section-C3-S2); avoid deep nesting (avoid section-C3-S2-S1-S1-S1)</p>
                    <p><strong>Status Transitions:</strong> Normal: dev → review → final → approved | Discard: any → deprecated | Forbidden: backwards transitions</p>
                </div>
            </div>

            <!-- Guide Version Rules Tab -->
            <div id="guide-rules" class="tab-content">
                <div id="regime" class="rule-section">
                    <h3>1. Versioning Regimes</h3>
                    <p><strong>Pre-publication (0.x.x.x):</strong> Internal development, structure may change, no published versions yet</p>
                    <p><strong>Post-publication (x.x.x):</strong> After 1.0.0, follows semantic versioning for editions and revisions</p>

                    <h3 style="margin-top: 20px;">Version System Naming</h3>
                    <div class="example-code">guide-vMAJOR.MINOR[.PATCH[.SUBPATCH]]-YYYYMMDD.tex

✅ guide-v0.1.0.0-20260105.tex (pre-pub)
✅ guide-v0.2.2.0-20260108.tex (pre-pub, current)
✅ guide-v1.0.0-20260315.tex (first published edition)
❌ guide-v0.2.2.0-2026-01-08.tex (wrong date format; use YYYYMMDD without hyphens)</parameter>
                    </div>
                </div>

                <div class="rule-section">
                    <h3>2. Pre-publication (0.x.x.x) Semantics</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Meaning</th>
                                <th>Range</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>MAJOR</strong></td>
                                <td>Always 0 (pre-publication marker)</td>
                                <td>0</td>
                                <td><code>0</code></td>
                            </tr>
                            <tr>
                                <td><strong>MINOR</strong></td>
                                <td>Chapter index entering guide (1st, 2nd, ... 7th chapter)</td>
                                <td>1-7</td>
                                <td><code>2</code> = 2nd chapter in guide</td>
                            </tr>
                            <tr>
                                <td><strong>PATCH</strong></td>
                                <td>Structural change: new sections, reorganization, tables affecting flow, bugfixes</td>
                                <td>0+</td>
                                <td><code>2</code> = 2nd structural change in MINOR</td>
                            </tr>
                            <tr>
                                <td><strong>SUBPATCH</strong></td>
                                <td>Refinements: typos, wording, small table adjustments</td>
                                <td>0+</td>
                                <td><code>1</code> = 1st refinement</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-section">
                    <h3>3. Pre-pub Increment Rules (When to Bump)</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Situation</th>
                                <th>Increment</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>New chapter enters guide</td>
                                <td><strong>MINOR</strong></td>
                                <td>v0.1.4.0 → v0.2.0.0</td>
                            </tr>
                            <tr>
                                <td>New section in active chapter</td>
                                <td><strong>PATCH</strong></td>
                                <td>v0.2.1.0 → v0.2.2.0</td>
                            </tr>
                            <tr>
                                <td>Reorganize chapter structure</td>
                                <td><strong>PATCH</strong></td>
                                <td>v0.2.1.0 → v0.2.2.0</td>
                            </tr>
                            <tr>
                                <td>Populate or revise major table</td>
                                <td><strong>PATCH</strong></td>
                                <td>v0.2.2.0 → v0.2.3.0</td>
                            </tr>
                            <tr>
                                <td>Major LaTeX syntax bugfix</td>
                                <td><strong>PATCH</strong></td>
                                <td>v0.1.3.0 → v0.1.4.0</td>
                            </tr>
                            <tr>
                                <td>Typos, wording, small cell adjustments</td>
                                <td><strong>SUBPATCH</strong></td>
                                <td>v0.2.2.0 → v0.2.2.1</td>
                            </tr>
                            <tr>
                                <td>Only compile/snapshot, no content change</td>
                                <td>Update <strong>date only</strong></td>
                                <td>v0.2.2.0-20260108 → v0.2.2.0-20260109</td>
                            </tr>
                            <tr>
                                <td>WIP file work (not yet integrated)</td>
                                <td><strong>NONE</strong> — changes guide version only on integration</td>
                                <td>section-C5-S2-... does not trigger bump</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-section">
                    <h3>4. Post-publication (x.x.x) Semantics</h3>
                    <p>Used after first published edition (1.0.0+). Follows traditional semantic versioning.</p>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Meaning</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>MAJOR</strong></td>
                                <td>Edition (1st, 2nd, 3rd...); major structural reorganization or compatibility-breaking changes</td>
                                <td><code>1</code>, <code>2</code></td>
                            </tr>
                            <tr>
                                <td><strong>MINOR</strong></td>
                                <td>Substantial revision within edition: new chapters, large expansions, internal reorganizations (but editable as same)</td>
                                <td><code>1</code> = 1st substantial revision in MAJOR</td>
                            </tr>
                            <tr>
                                <td><strong>PATCH</strong></td>
                                <td>Corrections, clarifications, typos, small adjustments</td>
                                <td><code>3</code> = 3rd patch release</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-section">
                    <h3>5. Post-pub Increment Rules</h3>
                    <table class="rule-table">
                        <thead>
                            <tr>
                                <th>Situation</th>
                                <th>Increment</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Reorganize chapters, change large structure</td>
                                <td><strong>MAJOR</strong></td>
                                <td>v1.3.2 → v2.0.0</td>
                            </tr>
                            <tr>
                                <td>Add new important chapter within edition</td>
                                <td><strong>MINOR</strong></td>
                                <td>v1.0.0 → v1.1.0</td>
                            </tr>
                            <tr>
                                <td>Substantial expansion of existing chapters</td>
                                <td><strong>MINOR</strong></td>
                                <td>v1.1.0 → v1.2.0</td>
                            </tr>
                            <tr>
                                <td>Typos, grammar, local fixes, small table adjustments</td>
                                <td><strong>PATCH</strong></td>
                                <td>v1.1.0 → v1.1.1</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-section">
                    <h3>6. Critical: Three Values Must Always Match</h3>
                    <div class="info-box">
                        <p><strong>1. LaTeX macro:</strong> <code>\docversion{}</code> in preamble</p>
                        <p><strong>2. Filename:</strong> <code>guide-vX.Y.Z-YYYYMMDD.tex</code></p>
                        <p><strong>3. PROJECT-TRACKING:</strong> Entry with matching version number</p>
                        <p style="margin-top: 10px;"><em>These three must be in sync at all times.</em></p>
                    </div>
                </div>

                <div class="rule-section">
                    <h3>7. Transition from 0.x.x.x to 1.0.0</h3>
                    <p><strong>Criteria:</strong> All planned chapters exist with narrative; guide is practically usable; consistency checked.</p>
                    <p><strong>Procedure:</strong> Select a 0.a.b.c base, create 1.0.0, move 0.x.x.x to history, freeze line 0.x.x.x.</p>
                    <p><strong>After 1.0:</strong> All changes follow x.y.z regime (editions & revisions); no new 0.x.x.x versions created.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function setMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.wip-mode, .guide-mode').forEach(el => el.classList.remove('active'));
            
            if (mode === 'wip') {
                document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
                document.querySelector('.wip-mode').classList.add('active');
            } else {
                document.querySelector('.mode-btn:nth-child(2)').classList.add('active');
                document.querySelector('.guide-mode').classList.add('active');
            }
        }

        function updateWIPFields() {
            const category = document.getElementById('wipCategory').value;
            document.querySelectorAll('[id$="Fields"]').forEach(el => el.style.display = 'none');
            
            if (category === 'chapter') {
                document.getElementById('chapterFields').style.display = 'block';
            } else if (category === 'section') {
                document.getElementById('sectionFields').style.display = 'block';
            } else if (category === 'table') {
                document.getElementById('tableFields').style.display = 'block';
            } else if (category === 'notes') {
                document.getElementById('notesFields').style.display = 'block';
            } else if (category === 'visual') {
                document.getElementById('visualFields').style.display = 'block';
            }
        }

        function updateGuideFields() {
            const regime = document.getElementById('guideRegime').value;
            document.getElementById('prepubFields').style.display = regime === 'prepub' ? 'block' : 'none';
            document.getElementById('postpubFields').style.display = regime === 'postpub' ? 'block' : 'none';
        }

        function validateWIPDate(dateStr) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            if (!regex.test(dateStr)) return false;
            const [y, m, d] = dateStr.split('-').map(Number);
            const date = new Date(y, m - 1, d);
            return date.getFullYear() === y && date.getMonth() === m - 1 && date.getDate() === d;
        }

        function validateGuideDate(dateStr) {
            const regex = /^\d{8}$/;
            if (!regex.test(dateStr)) return false;
            const y = parseInt(dateStr.substring(0, 4));
            const m = parseInt(dateStr.substring(4, 6));
            const d = parseInt(dateStr.substring(6, 8));
            const date = new Date(y, m - 1, d);
            return date.getFullYear() === y && date.getMonth() === m - 1 && date.getDate() === d;
        }

        function slugify(text) {
            if (!text) return '';
            return text.toLowerCase()
                .trim()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
        }

        function generateWIPName() {
            const category = document.getElementById('wipCategory').value;
            const dateInput = document.getElementById('wipDate').value;
            let filename = '';
            let validations = [];

            if (!dateInput) {
                validations.push({ type: 'error', msg: 'Date is required (YYYY-MM-DD format)' });
            } else if (!validateWIPDate(dateInput)) {
                validations.push({ type: 'error', msg: 'Invalid date format. Use YYYY-MM-DD (e.g., 2026-01-15)' });
            }

            if (!category) {
                validations.push({ type: 'error', msg: 'Select a file category' });
            }

            if (category === 'chapter') {
                const num = document.getElementById('chapterNum').value;
                const title = slugify(document.getElementById('chapterTitle').value);
                const status = document.getElementById('chapterStatus').value;

                if (!num || num < 1 || num > 7) validations.push({ type: 'error', msg: 'Chapter number must be 1-7' });
                if (!title) validations.push({ type: 'error', msg: 'Title is required' });
                if (!status) validations.push({ type: 'error', msg: 'Status is required' });
                if (title.length > 30) validations.push({ type: 'warning', msg: 'Title may be too long; consider shortening' });

                if (!validations.some(v => v.type === 'error')) {
                    filename = `chapter-C${num}-${title}-${status}-${dateInput}.tex`;
                }
            } else if (category === 'section') {
                const ch = document.getElementById('secChapter').value;
                const sec = document.getElementById('secSection').value;
                const subsec = document.getElementById('secSubsection').value;
                const subsubsec = document.getElementById('secSubsubsection').value;
                const title = slugify(document.getElementById('secTitle').value);
                const status = document.getElementById('secStatus').value;

                if (!ch || ch < 1 || ch > 7) validations.push({ type: 'error', msg: 'Chapter must be 1-7' });
                if (!sec || sec < 1) validations.push({ type: 'error', msg: 'Section number required (≥1)' });
                if (!title) validations.push({ type: 'error', msg: 'Title is required' });
                if (!status) validations.push({ type: 'error', msg: 'Status is required' });

                if (subsubsec && !subsec) validations.push({ type: 'error', msg: 'Cannot have sub-subsection without subsection' });
                if (subsubsec) validations.push({ type: 'warning', msg: 'Deep nesting (3+ levels) discouraged. Consider shallower structure.' });

                if (title.length > 40) validations.push({ type: 'warning', msg: 'Title long; consider reducing hierarchy depth or shortening' });

                if (!validations.some(v => v.type === 'error')) {
                    let hierarchy = `C${ch}-S${sec}`;
                    if (subsec) hierarchy += `-S${subsec}`;
                    if (subsubsec) hierarchy += `-S${subsubsec}`;
                    filename = `section-${hierarchy}-${title}-${status}-${dateInput}.tex`;
                }
            } else if (category === 'table') {
                const ch = document.getElementById('tblChapter').value;
                const context = document.getElementById('tblContext').value.toUpperCase();
                const sw = document.getElementById('tblSwitch').value;
                const status = document.getElementById('tblStatus').value;

                if (!ch || ch < 1 || ch > 7) validations.push({ type: 'error', msg: 'Chapter must be 1-7' });
                if (!context) validations.push({ type: 'error', msg: 'Context code required (AA, AG, DGFT, etc.)' });
                if (!sw) validations.push({ type: 'error', msg: 'Switch type required (TMS, DMS, or CMS)' });
                if (!status) validations.push({ type: 'error', msg: 'Status is required' });

                if (!validations.some(v => v.type === 'error')) {
                    filename = `table-C${ch}-${context}-${sw}-${status}-${dateInput}.tex`;
                }
            } else if (category === 'notes') {
                const ch = document.getElementById('notesChapter').value.toUpperCase();
                const topic = slugify(document.getElementById('notesTopic').value);
                const type = document.getElementById('notesType').value;

                if (!ch) validations.push({ type: 'error', msg: 'Chapter/GEN required' });
                if (ch !== 'GEN' && !/^C[1-7]$/.test(ch)) validations.push({ type: 'error', msg: 'Chapter must be C1-C7 or GEN' });
                if (!topic) validations.push({ type: 'error', msg: 'Topic is required' });
                if (!type) validations.push({ type: 'error', msg: 'Note type is required' });

                if (!validations.some(v => v.type === 'error')) {
                    filename = `notes-${ch}-${topic}-${type}-${dateInput}.md`;
                }
            } else if (category === 'visual') {
                const ch = document.getElementById('visChapter').value;
                const desc = slugify(document.getElementById('visDescription').value);
                const type = document.getElementById('visType').value;
                const status = document.getElementById('visStatus').value;
                const ext = document.getElementById('visExtension').value.toLowerCase();

                if (!ch || ch < 1 || ch > 7) validations.push({ type: 'error', msg: 'Chapter must be 1-7' });
                if (!desc) validations.push({ type: 'error', msg: 'Description is required' });
                if (!type) validations.push({ type: 'error', msg: 'Visual type is required' });
                if (!status) validations.push({ type: 'error', msg: 'Status is required' });
                if (!ext) validations.push({ type: 'error', msg: 'File extension required (svg, pdf, png, tex)' });
                if (ext && !['svg', 'pdf', 'png', 'tex'].includes(ext)) {
                    validations.push({ type: 'warning', msg: 'Common extensions: svg, pdf, png, tex' });
                }

                if (!validations.some(v => v.type === 'error')) {
                    filename = `visual-C${ch}-${desc}-${type}-${status}-${dateInput}.${ext}`;
                }
            }

            const output = document.getElementById('wipOutput');
            if (validations.length === 0) {
                document.getElementById('wipFilename').textContent = filename;
                const validation = document.getElementById('wipValidation');
                validation.innerHTML = '<div class="validation-result success"><span class="validation-icon">✓</span> Valid filename generated</div>';
                output.style.display = 'block';
            } else {
                const validation = document.getElementById('wipValidation');
                validation.innerHTML = validations.map(v => 
                    `<div class="validation-result ${v.type}"><span class="validation-icon">${v.type === 'error' ? '✗' : '⚠'}</span> ${v.msg}</div>`
                ).join('');
                output.style.display = 'block';
                if (filename) {
                    document.getElementById('wipFilename').textContent = filename;
                }
            }
        }

        function generateGuideName() {
            const regime = document.getElementById('guideRegime').value;
            const dateInput = document.getElementById('guideDate').value;
            let filename = '';
            let version = '';
            let validations = [];

            if (!dateInput) {
                validations.push({ type: 'error', msg: 'Build date required (YYYYMMDD format)' });
            } else if (!validateGuideDate(dateInput)) {
                validations.push({ type: 'error', msg: 'Invalid date format. Use YYYYMMDD (e.g., 20260108)' });
            }

            if (!regime) {
                validations.push({ type: 'error', msg: 'Select a regime (pre-pub or post-pub)' });
            }

            if (regime === 'prepub') {
                const minor = document.getElementById('prepubMinor').value;
                const patch = document.getElementById('prepubPatch').value || '0';
                const subpatch = document.getElementById('prepubSubpatch').value || '0';

                if (!minor || minor < 1 || minor > 7) {
                    validations.push({ type: 'error', msg: 'MINOR must be 1-7 (chapter index)' });
                } else {
                    version = `0.${minor}.${patch}.${subpatch}`;
                    filename = `guide-v${version}-${dateInput}.tex`;
                }
            } else if (regime === 'postpub') {
                const major = document.getElementById('postpubMajor').value;
                const minor = document.getElementById('postpubMinor').value || '0';
                const patch = document.getElementById('postpubPatch').value || '0';

                if (!major || major < 1) {
                    validations.push({ type: 'error', msg: 'MAJOR must be ≥1' });
                } else {
                    version = `${major}.${minor}.${patch}`;
                    filename = `guide-v${version}-${dateInput}.tex`;
                }
            }

            const output = document.getElementById('guideOutput');
            if (validations.length === 0) {
                document.getElementById('guideFilename').textContent = filename;
                const validation = document.getElementById('guideValidation');
                validation.innerHTML = '<div class="validation-result success"><span class="validation-icon">✓</span> Valid filename generated</div>';

                // Show LaTeX macros
                const macros = `\\newcommand{\\docversion}{${version}}
\\newcommand{\\docbuild}{${dateInput}}
\\newcommand{\\fulldocversion}{\\docversion+\\docbuild}`;
                document.getElementById('latexMacros').textContent = macros;
                document.getElementById('latexMacros').style.display = 'block';

                output.style.display = 'block';
            } else {
                const validation = document.getElementById('guideValidation');
                validation.innerHTML = validations.map(v => 
                    `<div class="validation-result ${v.type}"><span class="validation-icon">${v.type === 'error' ? '✗' : '⚠'}</span> ${v.msg}</div>`
                ).join('');
                output.style.display = 'block';
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard: ' + text);
            });
        }

        function switchTab(event, tabName) {
            event.target.parentElement.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function scrollToTab(tabId, sectionId) {
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));

            const targetTab = Array.from(tabs).find(tab => {
                const onclick = tab.getAttribute('onclick');
                return onclick && onclick.includes(tabId);
            });
            if (targetTab) targetTab.classList.add('active');

            document.getElementById(tabId).classList.add('active');
            setTimeout(() => {
                document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function showInfo(key) {
            const messages = {
                'chapterNum': 'Chapter number must be between 1 and 7, corresponding to planned guide structure.',
                'tblSwitch': 'TMS = Tactical Mode Switch, DMS = Defensive Management System, CMS = Countermeasure System',
                'dateWIP': 'WIP files use ISO 8601 format with hyphens: YYYY-MM-DD (e.g., 2026-01-15)',
                'dateGuide': 'Guide versions use compact format without hyphens: YYYYMMDD (e.g., 20260108)',
                'minor': 'MINOR in 0.x.x.x represents the chapter index (1st, 2nd, ... 7th chapter to enter the guide)—not the literal chapter number.'
            };
            if (messages[key]) {
                alert(messages[key]);
            }
        }
    </script>
</body>
</html>
